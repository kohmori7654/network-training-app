name: Supabase Keep Alive

on:
  schedule:
    - cron: '0 0 * * *' # 毎日 UTC 0:00 (日本時間 9:00)
  workflow_dispatch:

jobs:
  ping-db:
    runs-on: ubuntu-latest
    steps:
      - name: Disable IPv6 (Force IPv4)
        run: |
          # ネットワークエラーの原因となるIPv6を無効化し、IPv4接続を強制します
          sudo sysctl -w net.ipv6.conf.all.disable_ipv6=1
          sudo sysctl -w net.ipv6.conf.default.disable_ipv6=1

      - name: Install PostgreSQL Client
        run: |
          sudo apt-get update
          sudo apt-get install -y postgresql-client

      - name: Run Keep-Alive Query
        run: psql -c "SELECT 1;"
        env:
          # シンプルな直接接続の設定（ここなら間違いないです）
          PGHOST: db.adfxadnpcrtyfeqgfqfm.supabase.co
          PGPORT: 5432
          PGUSER: postgres
          PGDATABASE: postgres
          PGPASSWORD: ${{ secrets.SUPABASE_PASSWORD }}
